# Cache 组件实施手册

## 功能边界
- 提供 key/value 缓存读写、批量删除、TTL 管理。
- 支撑常见治理能力：热点保护、分布式锁、幂等依赖。
- 默认对接 Redis，可扩展为其他后端。

## 代码位置
- 接口：`pkg/cache/cache.go`
- 默认实现：`internal/cache/redis`
- 相关常量与错误：`pkg/cache/errors.go`

## 开发步骤
1. **接口约束**：补全 `Cache`、`Lock` 等接口及必要的选项函数。
2. **配置结构**：定义 `Config`，涵盖连接信息、池化参数、命名空间前缀。
3. **Redis 实现**：
   - 使用 `redis/v9` 客户端封装常用操作。
   - 引入连接池指标采集与慢命令日志。
4. **扩展能力**：实现分布式锁（基于 Lua 脚本）与缓存击穿保护。
5. **依赖注入**：提供 `fx` 模块，支持通过配置注册为单例。

## 测试要点
- 单测覆盖：基本读写、TTL、生存期命中、锁获取/释放。
- 集成测试：基于 docker-compose 起 Redis，验证重连与多实例竞争。
- 观测：暴露连接池使用量、命令耗时直方图，日志记录超时/网络错误。

## 验收清单
- 缓存 miss 明确定义并向上返回。
- 失败场景具备自动重试或降级策略，日志足以追踪。
- 文档更新：在 `usage_guide.md` 写入示例代码与主要配置段落。

## 后续演进
- 引入本地缓存 + 布隆过滤器双层策略。
- 支持多机房部署时的读写分离及一致性控制。
