# Genesis 项目设计手册

## 项目定位
- 面向 Go 的微服务基座，聚焦稳定性、可观测性和可扩展性。
- 目标：沉淀一套可复用的基础设施组件，支撑新服务在数小时内完成骨架搭建。
- 使用场景：学习与展示现代微服务工程能力，同时可演进为真实项目的脚手架。

## 架构原则
- 抽象清晰：业务代码只依赖 `pkg` 中的接口定义，不触达具体实现。
- 插件化实现：所有实现落在 `internal` 目录，可替换、可扩展、可做 A/B 验证。
- 依赖注入：统一采用 `go.uber.org/fx` 进行依赖装配，确保组件生命周期受控。
- 可观测优先：日志、指标、追踪在第一时间接入，默认启用。
- 简洁交付：默认配置可直接启动，复杂能力通过选项按需开启。

## 仓库结构
```
genesis/
├── cmd/                    # 可执行入口
│   └── server/
│       └── main.go
├── configs/                # 静态配置与样例
│   └── config.yaml
├── internal/               # 具体实现，按能力分层
│   ├── cache/redis/
│   ├── config/viper/
│   ├── log/zap/
│   ├── db/gorm/
│   ├── uid/snowflake/
│   ├── mq/kafka/
│   ├── coord/etcd/
│   └── middleware/
│       ├── ratelimiter/
│       ├── idempotency/
│       └── breaker/
├── pkg/                    # 对外暴露的接口与契约
│   ├── cache/
│   ├── config/
│   ├── db/
│   ├── log/
│   ├── mq/
│   ├── coord/
│   ├── uid/
│   └── middleware/
├── docs/                   # 设计与使用文档
└── go.mod
```

## 核心组件概览
- `config`：聚合静态文件、环境变量、远程配置，支持热更新回调。
- `log`：结构化日志，自动注入请求上下文。
- `db`：数据库连接与事务抽象，默认集成 GORM。
- `cache`：通用缓存访问接口，包含分布式锁辅助能力。
- `uid`：Snowflake 全局 ID，支持 etcd WorkerID 分配。
- `mq`：消息生产与消费接口，默认封装 Kafka。
- `coord`：分布式协调基础能力（锁、选主、配置订阅）。
- `middleware`：限流、幂等、熔断等服务治理插件。

## 工程实践基线
- 统一模块管理：单仓库管理所有组件，`go mod tidy` 维持依赖干净。
- 质量保障：
  - 单测覆盖核心逻辑，新增组件需附带最小可行测试。
  - 提供基准测试样例，验证关键路径性能。
  - 必要处写入示例（`*_example_test.go`）以生成文档化用法。
- 可观测性：
  - 新组件至少暴露基本 metrics counter/gauge。
  - 错误需分级记录日志：`Warn` 可恢复，`Error` 需告警。

## 开发路线图
1. **基础骨架**
   - 建立目录结构与 go module。
   - 接入 `fx`，完成 `config`、`log` 的最小实现。
2. **数据通道**
   - 交付 `db`、`cache`、`uid` 基础能力。
   - 提供本地 Docker Compose 用例，便于集成测试。
3. **服务治理**
   - 完成限流、熔断、幂等中间件抽象与默认实现。
   - 将治理能力透出给业务代码（HTTP/gRPC 示例）。
4. **可观测性与工具**
   - 接入指标、追踪；完善 CLI 或 Makefile 流程。
   - 编写实践指南与案例文档。

## 交付节奏建议
- 每个组件遵循「接口 → 默认实现 → 测试 → 文档 → 示例」顺序。
- 首次提交保持 MVP，可用性 > 完整性；迭代补充扩展功能。
- 每个阶段完成后进行复盘：产出待办列表，更新 `docs/` 指南。
